<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PROCASEF Dashboard ‚Äì Boundou</title>

  <!-- Styles -->
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;550;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" 
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous" />
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar" id="sidebar">
        <div class="p-3 text-center">
            <h4 class="mb-0">PROCASEF</h4>
        </div>
        <nav class="nav flex-column">
            <div class="nav-item active" data-section="accueil">
                <span class="nav-text">üè† Accueil</span>
            </div>
            <div class="nav-item" data-section="parcelles">
                <span class="nav-text">üìç Parcelles</span>
            </div>
            <div class="nav-item" data-section="etat-avancement">
                <span class="nav-text">üìà √âtat d'Avancement</span>
            </div>
            <div class="nav-item" data-section="projections-2025">
                <span class="nav-text">üéØ Projections 2025</span>
            </div>
            <div class="nav-item" data-section="rapport">
                <span class="nav-text">üìä Rapport Complet</span>
            </div>
            <div class="nav-item" data-section="stats-topo">
                <span class="nav-text">üìè Stats Topo</span>
            </div>
        </nav>
    </div>

    <!-- Main Content Area -->
    <div class="main-content" id="mainContent">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <button id="sidebarToggle" class="btn btn-primary">
                    <i class="fas fa-bars"></i>
                </button>
                <h2 id="pageTitle" class="d-inline ms-3">Dashboard PROCASEF</h2>
            </div>
            <div class="d-flex align-items-center">
                <button id="fontDecrease" class="btn btn-outline-secondary me-2" title="Diminuer la taille">A-</button>
                <input id="fontSizeSlider" type="range" min="12" max="20" value="14" 
                       class="form-range me-2" style="width: 100px;" title="Taille de police">
                <span id="fontTooltip" class="me-2">14px</span>
                <button id="fontIncrease" class="btn btn-outline-secondary" title="Augmenter la taille">A+</button>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="d-none">
            <div class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center" 
                 style="background: rgba(0,0,0,0.5); z-index: 9999;">
                <div class="bg-white p-4 rounded text-center">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">Chargement...</span>
                    </div>
                    <div>Chargement des donn√©es...</div>
                </div>
            </div>
        </div>

        <!-- Section Accueil -->
        <div id="accueil-section" class="content-section active">
            <div class="section-header">
                <h3>üè† Tableau de Bord Principal</h3>
                <p class="section-description">Vue d'ensemble des indicateurs cl√©s du projet PROCASEF √† Boundou</p>
            </div>
            
            <!-- KPI Grid -->
            <div class="row g-3 mb-4" id="kpiGrid">
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="kpi-header">Total Parcelles</div>
                        <div id="totalParcelles" class="kpi-value">31,302</div>
                        <div class="kpi-subtitle">Parcelles identifi√©es</div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="kpi-header">Parcelles NICAD</div>
                        <div id="parcellesNicad" class="kpi-value">17,146</div>
                        <div id="percentageNicad" class="kpi-subtitle">54.8% avec NICAD</div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="kpi-header">Parcelles D√©lib√©r√©es</div>
                        <div id="parcellesDeliberees" class="kpi-value">11,036</div>
                        <div id="percentageDeliberees" class="kpi-subtitle">35.3% d√©lib√©r√©es</div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="kpi-header">Superficie Totale</div>
                        <div id="superficieTotale" class="kpi-value">67,934.12</div>
                        <div class="kpi-subtitle">Hectares</div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="kpi-header">Taux R√©alisation</div>
                        <div id="tauxRealisation" class="kpi-value">47.80%</div>
                        <div class="kpi-subtitle">33,457 / 70,000</div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="kpi-header">Communes Actives</div>
                        <div class="kpi-value">13/17</div>
                        <div class="kpi-subtitle">Zones d'intervention</div>
                    </div>
                </div>
            </div>
            
            <!-- Charts Grid -->
            <div class="row g-3">
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>Top Communes par Parcelles</h4>
                        <canvas id="topCommunesChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>Projections Mensuelles 2025</h4>
                        <canvas id="projectionsChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>R√©partition Genre Global</h4>
                        <canvas id="genreGlobalChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Parcelles -->
        <div id="parcelles-section" class="content-section">
            <div class="section-header">
                <h3>üìç R√©partition des Parcelles</h3>
                <p class="section-description">Analyse g√©ographique et statistique des parcelles</p>
            </div>
            
            <!-- Filters -->
            <div class="mb-3">
                <select id="communeFilter" class="form-select d-inline-block w-auto me-2">
                    <option value="">Toutes les communes</option>
                </select>
                <select id="nicadFilter" class="form-select d-inline-block w-auto me-2">
                    <option value="">Toutes les parcelles</option>
                    <option value="Oui">Avec NICAD</option>
                    <option value="Non">Sans NICAD</option>
                </select>
                <select id="deliberationFilter" class="form-select d-inline-block w-auto me-2">
                    <option value="">Toutes les d√©lib√©rations</option>
                    <option value="Oui">D√©lib√©r√©es</option>
                    <option value="Non">Non d√©lib√©r√©es</option>
                </select>
                <button id="exportParcellesBtn" class="btn btn-primary">
                    <i class="fas fa-download me-1"></i>Exporter
                </button>
            </div>
            
            <!-- Charts and Map -->
            <div class="row g-3">
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>Distribution par R√©gion</h4>
                        <canvas id="regionChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>Progression NICAD par Commune</h4>
                        <canvas id="nicadChart"></canvas>
                    </div>
                </div>
                <div class="col-12">
                    <div class="chart-container">
                        <h4>Carte Interactive des Communes</h4>
                        <div id="mapContainer"></div>
                    </div>
                </div>
            </div>
            
            <!-- Data Table -->
            <div class="mt-4">
                <h4>Donn√©es d√©taill√©es par commune</h4>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Commune</th>
                                <th>R√©gion</th>
                                <th>Total Parcelles</th>
                                <th>NICAD</th>
                                <th>% NICAD</th>
                                <th>D√©lib√©r√©es</th>
                                <th>% D√©lib√©r√©es</th>
                                <th>Superficie (ha)</th>
                            </tr>
                        </thead>
                        <tbody id="parcellesTableBody">
                            <!-- Donn√©es dynamiques -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Section √âtat d'Avancement -->
        <div id="etat-avancement-section" class="content-section">
            <div class="section-header">
                <h3>üìà √âtat des Op√©rations</h3>
                <p class="section-description">Suivi de l'avancement des op√©rations par commune et r√©gion</p>
            </div>
            
            <!-- Filters -->
            <div class="mb-3">
                <select id="regionFilterEtat" class="form-select d-inline-block w-auto me-2">
                    <option value="">Toutes les r√©gions</option>
                </select>
                <select id="etatFilterEtat" class="form-select d-inline-block w-auto me-2">
                    <option value="">Tous les √©tats</option>
                </select>
                <select id="communeFilterEtat" class="form-select d-inline-block w-auto me-2">
                    <option value="">Toutes les communes</option>
                </select>
                <select id="csigFilterEtat" class="form-select d-inline-block w-auto me-2">
                    <option value="">Tous les CSIG</option>
                </select>
            </div>
            
            <!-- Progress and Charts -->
            <div class="row g-3">
                <div class="col-lg-12">
                    <div class="chart-container">
                        <h4>Progression Globale</h4>
                        <div class="progress" style="height: 30px;">
                            <div id="globalProgressFill" class="progress-bar" role="progressbar" 
                                 style="width: 47.8%;" aria-valuenow="47.8" aria-valuemin="0" aria-valuemax="100">
                                <span id="globalProgressText">47.8%</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>√âtat par Commune</h4>
                        <canvas id="etatCommuneBarChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>R√©partition des √âtats</h4>
                        <canvas id="etatDonutChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="chart-container">
                        <h4>Timeline par Commune</h4>
                        <div id="etatTimeline"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Projections 2025 -->
        <div id="projections-2025-section" class="content-section">
            <div class="section-header">
                <h3>üéØ Projections et Objectifs 2025</h3>
                <p class="section-description">Suivi des objectifs et des r√©alisations pour 2025</p>
            </div>
            
            <!-- Objectives KPIs -->
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <div class="kpi-card">
                        <div class="kpi-header">Objectif 2025</div>
                        <div id="objectif2025" class="kpi-value">70,000</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="kpi-card">
                        <div class="kpi-header">R√©alis√©</div>
                        <div id="realise2025" class="kpi-value">31,302</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="kpi-card">
                        <div class="kpi-header">Performance</div>
                        <div id="performance2025" class="kpi-value">44.72%</div>
                    </div>
                </div>
            </div>
            
            <!-- Charts -->
            <div class="row g-3">
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>Objectifs vs R√©alisations</h4>
                        <canvas id="objectifsChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>Performance par P√©riode</h4>
                        <div id="performanceList" class="list-group"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Rapport -->
        <div id="rapport-section" class="content-section">
            <div class="section-header">
                <h3>üìä Rapport Complet</h3>
                <p class="section-description">Analyse d√©taill√©e des donn√©es du projet PROCASEF Boundou</p>
            </div>
            
            <!-- Export Button -->
            <div class="mb-3">
                <button id="exportRapportGenreBtn" class="btn btn-primary me-2">
                    <i class="fas fa-file-pdf me-1"></i>Exporter Rapport Genre
                </button>
            </div>
            
            <!-- Dynamic KPIs -->
            <div class="row g-3 mb-4" id="rapportKpiGrid"></div>
            
            <!-- Charts -->
            <div class="row g-3">
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>D√©tail par Source</h4>
                        <canvas id="rapportSourceChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>Top 10 Communes</h4>
                        <canvas id="rapportCommuneMixedChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>Analyse Temporelle</h4>
                        <canvas id="rapportTemporalChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>R√©partition R√©gionale</h4>
                        <canvas id="rapportRegionPolarChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Stats Topo -->
        <div id="stats-topo-section" class="content-section">
            <div class="section-header">
                <h3>üìè Statistiques Topographiques</h3>
                <p class="section-description">Analyse d√©taill√©e des lev√©s topographiques - Donn√©es en temps r√©el</p>
            </div>
            
            <!-- Filters -->
            <div class="mb-3">
                <select id="topoCommuneFilter" class="form-select d-inline-block w-auto me-2">
                    <option value="">Toutes les communes</option>
                </select>
                <select id="topoTopographeFilter" class="form-select d-inline-block w-auto me-2">
                    <option value="">Tous les topographes</option>
                </select>
                <input id="topoDateDebut" type="date" class="form-control d-inline-block w-auto me-2">
                <input id="topoDateFin" type="date" class="form-control d-inline-block w-auto me-2">
                <button id="clearDateRange" class="btn btn-outline-secondary me-2">
                    <i class="fas fa-eraser me-1"></i>Effacer
                </button>
                <button id="exportTopoBtn" class="btn btn-primary">
                    <i class="fas fa-download me-1"></i>Exporter
                </button>
            </div>
            
            <!-- Topo KPIs -->
            <div class="row g-3 mb-4">
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="kpi-header">Total Champs</div>
                        <div id="totalChampsKPI" class="kpi-value">0</div>
                        <div class="kpi-subtitle">Parcelles champs lev√©es</div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="kpi-header">Total B√¢tis</div>
                        <div id="totalBatisKPI" class="kpi-value">0</div>
                        <div class="kpi-subtitle">Parcelles b√¢ties lev√©es</div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="kpi-header">Total Parcelles</div>
                        <div id="totalTopoParcellesKPI" class="kpi-value">0</div>
                        <div class="kpi-subtitle">Total g√©n√©ral lev√©</div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="kpi-header">Moyenne/Jour</div>
                        <div id="avgParJourKPI" class="kpi-value">0</div>
                        <div class="kpi-subtitle">Parcelles par jour</div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="kpi-header">Top Topographe</div>
                        <div id="topTopoKPI" class="kpi-value">-</div>
                        <div class="kpi-subtitle">Plus productif</div>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <div class="kpi-card">
                        <div class="kpi-header">Topographes Actifs</div>
                        <div id="activeTopoKPI" class="kpi-value">0</div>
                        <div class="kpi-subtitle">En activit√©</div>
                    </div>
                </div>
            </div>
            
            <!-- Topo Charts -->
            <div class="row g-3">
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>Top 10 Topographes</h4>
                        <canvas id="topToposChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>Totaux par Commune</h4>
                        <canvas id="topoCommuneChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>√âvolution Mensuelle</h4>
                        <canvas id="topoEvolutionChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4>R√©partition Type</h4>
                        <canvas id="topoTypeDonut"></canvas>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="chart-container">
                        <h4>Timeline des Op√©rations</h4>
                        <div id="topoTimeline"></div>
                    </div>
                </div>
            </div>
            
            <!-- Topo Table -->
            <div class="mt-4">
                <h4>Donn√©es compl√®tes des lev√©s topographiques</h4>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Date</th>
                                <th>Topographe</th>
                                <th>Commune</th>
                                <th>Champs</th>
                                <th>B√¢tis</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="topoTableBody">
                            <!-- Donn√©es dynamiques -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@3.6.0/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <!-- Application Scripts -->
    <script src="js/data-loader.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/map.js"></script>
    <script src="js/app.js"></script>

</body>
</html>
