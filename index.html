<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROCASEF Dashboard - Boundou</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;550;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-section">
                    <div class="logo-icon">
                        <i class="fas fa-map-marked-alt"></i>
                    </div>
                    <div class="logo-text">PROCASEF</div>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle" aria-label="Basculer la sidebar">
                    <div class="hamburger"></div>
                </button>
            </div>
            
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-section="accueil">
                    <i class="nav-icon fas fa-home"></i>
                    <span class="nav-text">Accueil</span>
                </a>
                <a href="#" class="nav-item" data-section="parcelles">
                    <i class="nav-icon fas fa-map"></i>
                    <span class="nav-text">Parcelles</span>
                </a>
                <a href="#" class="nav-item" data-section="etat-avancement">
                    <i class="nav-icon fas fa-tasks"></i>
                    <span class="nav-text">√âtat d'Avancement</span>
                </a>
                <a href="#" class="nav-item" data-section="projections-2025">
                    <i class="nav-icon fas fa-chart-line"></i>
                    <span class="nav-text">Projections 2025</span>
                </a>
                <a href="#" class="nav-item" data-section="genre">
                    <i class="nav-icon fas fa-users"></i>
                    <span class="nav-text">R√©partition Genre</span>
                </a>
                <a href="#" class="nav-item" data-section="rapport">
                    <i class="nav-icon fas fa-file-alt"></i>
                    <span class="nav-text">Rapport Complet</span>
                </a>
                <a href="#" class="nav-item" data-section="stats-topo">
                    <i class="nav-icon fas fa-ruler-combined"></i>
                    <span class="nav-text">Stats Topo</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="app-header">
                <div class="header-content">
                    <div class="header-left">
                        <div class="header-logo">
                            <i class="fas fa-map-marked-alt"></i>
                        </div>
                        <h1 class="page-title" id="pageTitle">Dashboard PROCASEF</h1>
                    </div>
                    <div class="header-actions">
                        <div class="font-size-control">
                            <button type="button" class="font-btn" id="fontDecrease" aria-label="Diminuer la taille">A-</button>
                            <div class="font-slider-container">
                                <input type="range" class="font-slider" id="fontSizeSlider" min="12" max="20" value="14" aria-label="Taille de police">
                                <div class="font-tooltip" id="fontTooltip">14px</div>
                            </div>
                            <button type="button" class="font-btn" id="fontIncrease" aria-label="Augmenter la taille">A+</button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Loading Overlay -->
            <div id="loadingOverlay" class="loading-container">
                <div class="spinner"></div>
                <p>Chargement des donn√©es...</p>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Section Accueil -->
                <section id="accueil-section" class="content-section active">
                    <div class="section-header">
                        <div>
                            <h2>üè† Tableau de Bord Principal</h2>
                            <p class="section-description">Vue d'ensemble des indicateurs cl√©s du projet PROCASEF √† Boundou</p>
                        </div>
                    </div>

                    <!-- KPI Grid -->
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-header">
                                <h3>Total Parcelles</h3>
                                <i class="kpi-icon fas fa-map-marked-alt"></i>
                            </div>
                            <div class="kpi-value" id="totalParcellesKPI">31,302</div>
                            <div class="kpi-subtitle">Parcelles identifi√©es</div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-header">
                                <h3>Parcelles NICAD</h3>
                                <i class="kpi-icon fas fa-check-circle"></i>
                            </div>
                            <div class="kpi-value success" id="nicadParcellesKPI">17,146</div>
                            <div class="kpi-subtitle">54.8% avec NICAD</div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-header">
                                <h3>Parcelles D√©lib√©r√©es</h3>
                                <i class="kpi-icon fas fa-gavel"></i>
                            </div>
                            <div class="kpi-value" id="delibereesParcellesKPI">11,036</div>
                            <div class="kpi-subtitle">35.3% d√©lib√©r√©es</div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-header">
                                <h3>Superficie Totale</h3>
                                <i class="kpi-icon fas fa-expand-arrows-alt"></i>
                            </div>
                            <div class="kpi-value" id="superficieTotaleKPI">67,934.12</div>
                            <div class="kpi-subtitle">m¬≤</div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-header">
                                <h3>Taux R√©alisation</h3>
                                <i class="kpi-icon fas fa-chart-pie"></i>
                            </div>
                            <div class="kpi-value warning" id="tauxRealisationKPI">47.80%</div>
                            <div class="kpi-subtitle">33457 / 70000</div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-header">
                                <h3>Communes Actives</h3>
                                <i class="kpi-icon fas fa-city"></i>
                            </div>
                            <div class="kpi-value" id="communesActivesKPI">13/17</div>
                            <div class="kpi-subtitle">Zones d'intervention</div>
                        </div>
                    </div>

                    <!-- Charts Overview -->
                    <div class="charts-overview">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Top Communes par Parcelles</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="topCommunesChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Projections Mensuelles 2025</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="projectionsChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>R√©partition Genre Global</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="genreGlobalChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section Parcelles -->
                <section id="parcelles-section" class="content-section">
                    <div class="section-header">
                        <div>
                            <h2>üìä R√©partition des Parcelles</h2>
                        </div>
                        <div class="filter-panel">
                            <select id="communeFilter" class="form-control">
                                <option value="">Toutes les communes</option>
                            </select>
                            <select id="nicadFilter" class="form-control">
                                <option value="">Toutes les parcelles</option>
                                <option value="Oui">Avec NICAD</option>
                                <option value="Non">Sans NICAD</option>
                            </select>
                            <select id="deliberationFilter" class="form-control">
                                <option value="">Toutes les d√©lib√©rations</option>
                                <option value="Oui">D√©lib√©r√©es</option>
                                <option value="Non">Non d√©lib√©r√©es</option>
                            </select>
                            <button id="exportParcellesBtn" class="btn btn--primary">
                                <i class="fas fa-download"></i> Exporter CSV
                            </button>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Distribution par R√©gion</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="regionChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Progression NICAD par Commune</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="nicadChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card large">
                            <div class="chart-header">
                                <h3>Carte Interactive des Communes</h3>
                            </div>
                            <div class="chart-content">
                                <div id="mapContainer" style="height: 100%;"></div>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <div class="table-header">
                            <h3>Donn√©es d√©taill√©es par commune</h3>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="parcellesTable">
                                <thead>
                                    <tr>
                                        <th>R√©gion</th>
                                        <th>Commune</th>
                                        <th>Total Parcelles</th>
                                        <th>NICAD</th>
                                        <th>% NICAD</th>
                                        <th>D√©lib√©r√©es</th>
                                        <th>% D√©lib√©r√©es</th>
                                        <th>Superficie (ha)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Section √âtat des Op√©rations -->
                <section id="etat-avancement-section" class="content-section">
                    <div class="section-header">
                        <div>
                            <h2>üìà √âtat des Op√©rations</h2>
                        </div>
                        <div class="filter-panel">
                            <select id="regionFilterEtat" class="form-control">
                                <option value="">Toutes les r√©gions</option>
                            </select>
                            <select id="etatFilterEtat" class="form-control">
                                <option value="">Tous les √©tats</option>
                            </select>
                            <select id="communeFilterEtat" class="form-control">
                                <option value="">Toutes les communes</option>
                            </select>
                            <select id="csigFilterEtat" class="form-control">
                                <option value="">Tous les CSIG</option>
                            </select>
                        </div>
                    </div>

                    <div class="progress-overview">
                        <div class="progress-card">
                            <h3>Progression Globale</h3>
                            <div class="progress-bar-container">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="globalProgressFill" style="width: 67.4%;"></div>
                                </div>
                                <div class="progress-text" id="globalProgressText">67.4%</div>
                            </div>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>√âtat par Commune</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="etatCommuneBarChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>R√©partition des √âtats</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="etatDonutChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card large">
                            <div class="chart-header">
                                <h3>Timeline par Commune</h3>
                            </div>
                            <div class="timeline-container" id="etatTimeline">
                                <!-- Dynamic timeline content -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section Projections 2025 -->
                <section id="projections-2025-section" class="content-section">
                    <div class="section-header">
                        <div>
                            <h2>üéØ Projections et Objectifs 2025</h2>
                        </div>
                    </div>

                    <div class="metrics-row">
                        <div class="metric-card">
                            <h3>Objectif 2025</h3>
                            <div class="metric-value" id="objectif2025">70000</div>
                        </div>
                        <div class="metric-card">
                            <h3>R√©alis√©</h3>
                            <div class="metric-value success" id="realise2025">31 302</div>
                        </div>
                        <div class="metric-card">
                            <h3>Performance</h3>
                            <div class="metric-value warning" id="performance2025">44.72%</div>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Objectifs vs R√©alisations</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="objectifsChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Performance par P√©riode</h3>
                            </div>
                            <div class="performance-list" id="performanceList">
                                <!-- Dynamic performance content -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section Genre -->
                <section id="genre-section" class="content-section">
                    <div class="section-header">
                        <div>
                            <h2>üë´üèø R√©partition par Genre</h2>
                        </div>
                    </div>

                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-header">
                                <h3>Hommes</h3>
                                <i class="kpi-icon fas fa-male"></i>
                            </div>
                            <div class="kpi-value" id="hommesTotal">43,576</div>
                            <div class="kpi-subtitle">82.4%</div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-header">
                                <h3>Femmes</h3>
                                <i class="kpi-icon fas fa-female"></i>
                            </div>
                            <div class="kpi-value" id="femmesTotal">9,332</div>
                            <div class="kpi-subtitle">17.6%</div>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>R√©partition Globale</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="genreGlobalRepart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>√âvolution Trimestrielle</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="genreTrimestreChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card large">
                            <div class="chart-header">
                                <h3>R√©partition par Commune</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="genreCommuneChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section Rapport -->
                <section id="rapport-section" class="content-section">
                    <div class="section-header">
                        <div>
                            <h2>üë´üèø R√©partition par Genre</h2>
                            <p class="section-description">Analyse d√©taill√©e des donn√©es genre du projet PROCASEF Boundou</p>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>D√©tail par Source</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="rapportSourceChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Analyse par Commune (Top 10)</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="rapportCommuneChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Analyse Temporelle</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="rapportTemporelChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>R√©partition R√©gionale</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="rapportRegionalChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Nouvelle Section Stats Topo -->
                <section id="stats-topo-section" class="content-section">
                    <div class="section-header">
                        <div>
                            <h2>üìè Statistiques Topographiques</h2>
                            <p class="section-description">Analyse d√©taill√©e des lev√©s topographiques - Donn√©es en temps r√©el</p>
                        </div>
                        <div class="filter-panel">
                            <input type="date" id="dateFromFilter" class="form-control" placeholder="Date d√©but">
                            <input type="date" id="dateToFilter" class="form-control" placeholder="Date fin">
                            <select id="communeTopoFilter" class="form-control">
                                <option value="">Toutes les communes</option>
                            </select>
                            <select id="topographeFilter" class="form-control">
                                <option value="">Tous les topographes</option>
                            </select>
                            <select id="villageTopoFilter" class="form-control">
                                <option value="">Tous les villages</option>
                            </select>
                            <select id="typeTopoFilter" class="form-control">
                                <option value="">Tous les types</option>
                                <option value="champs">Champs</option>
                                <option value="batis">B√¢tis</option>
                            </select>
                            <button id="resetTopoFiltersBtn" class="btn btn--secondary">
                                <i class="fas fa-refresh"></i> Reset
                            </button>
                            <button id="exportTopoBtn" class="btn btn--primary">
                                <i class="fas fa-download"></i> Export CSV
                            </button>
                        </div>
                    </div>

                    <!-- KPI Stats Topo -->
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-header">
                                <h3>Total Champs</h3>
                                <i class="kpi-icon fas fa-seedling"></i>
                            </div>
                            <div class="kpi-value success" id="totalChampsKPI">0</div>
                            <div class="kpi-subtitle">Parcelles champs lev√©es</div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-header">
                                <h3>Total B√¢tis</h3>
                                <i class="kpi-icon fas fa-building"></i>
                            </div>
                            <div class="kpi-value" id="totalBatisKPI">0</div>
                            <div class="kpi-subtitle">Parcelles b√¢ties lev√©es</div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-header">
                                <h3>Total Parcelles</h3>
                                <i class="kpi-icon fas fa-map-marked-alt"></i>
                            </div>
                            <div class="kpi-value" id="totalParcellestopoKPI">0</div>
                            <div class="kpi-subtitle">Total g√©n√©ral lev√©</div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-header">
                                <h3>Moyenne/Jour</h3>
                                <i class="kpi-icon fas fa-calendar-day"></i>
                            </div>
                            <div class="kpi-value warning" id="avgParJourKPI">0</div>
                            <div class="kpi-subtitle">Parcelles par jour</div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-header">
                                <h3>Top Topographe</h3>
                                <i class="kpi-icon fas fa-medal"></i>
                            </div>
                            <div class="kpi-value" id="topTopoKPI">-</div>
                            <div class="kpi-subtitle">Plus productif</div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-header">
                                <h3>Topographes Actifs</h3>
                                <i class="kpi-icon fas fa-users"></i>
                            </div>
                            <div class="kpi-value" id="activeTopoKPI">0</div>
                            <div class="kpi-subtitle">En activit√©</div>
                        </div>
                    </div>

                    <!-- Charts Topo -->
                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Top 10 Topographes</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="topTopographesChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Totaux par Commune</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="topoCommunesChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card large">
                            <div class="chart-header">
                                <h3>√âvolution Mensuelle</h3>
                            </div>
                            <div class="chart-content">
                                <canvas id="topoEvolutionChart"></canvas>
                            </div>
                        </div>

                        <div class="chart-card large">
                            <div class="chart-header">
                                <h3>Timeline des Op√©rations</h3>
                            </div>
                            <div class="timeline-container" id="topoTimeline">
                                <!-- Dynamic timeline content -->
                            </div>
                        </div>
                    </div>

                    <!-- Table Topo -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3>Donn√©es compl√®tes des lev√©s topographiques</h3>
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <input type="text" id="tableTopoSearch" class="form-control" placeholder="Rechercher..." style="width: 250px;">
                                <select id="tableTopoPageSize" class="form-control" style="width: 150px;">
                                    <option value="10">10 par page</option>
                                    <option value="25">25 par page</option>
                                    <option value="50">50 par page</option>
                                    <option value="100">100 par page</option>
                                </select>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table" id="topoTable">
                                <thead>
                                    <tr>
                                        <th data-sort="date">Date <i class="fas fa-sort"></i></th>
                                        <th data-sort="topographe">Topographe <i class="fas fa-sort"></i></th>
                                        <th data-sort="commune">Commune <i class="fas fa-sort"></i></th>
                                        <th data-sort="village">Village <i class="fas fa-sort"></i></th>
                                        <th data-sort="champs">Champs <i class="fas fa-sort"></i></th>
                                        <th data-sort="batis">B√¢tis <i class="fas fa-sort"></i></th>
                                        <th data-sort="totale_parcelles">Total <i class="fas fa-sort"></i></th>
                                        <th data-sort="deroulement_des_operations">D√©roulement <i class="fas fa-sort"></i></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                        </div>
                        <div class="table-footer">
                            <div class="table-info" id="topoTableInfo">Affichage de 1 √† 10 sur 0 entr√©es</div>
                            <div class="table-pagination">
                                <button id="prevTopoPageBtn" class="btn btn--secondary" disabled>
                                    <i class="fas fa-chevron-left"></i> Pr√©c√©dent
                                </button>
                                <span id="currentTopoPage">Page 1 sur 1</span>
                                <button id="nextTopoPageBtn" class="btn btn--secondary" disabled>
                                    Suivant <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <!-- Application Scripts -->
    <script src="js/data-loader.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/map.js"></script>
    <script src="js/app.js"></script>

    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            window.procasefApp = new ProcasefDashboard();
        });
    </script>
</body>
</html>
